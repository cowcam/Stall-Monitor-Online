<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup - Stall Monitor</title>
    <link rel="icon" href="/assets/stallmonitor.png" type="image/png">
    <link rel="stylesheet" href="/assets/style.css">
</head>
<body>
    <header class="header">
        <img src="/assets/stallmonitor.png" alt="Stall Monitor Logo">
        <h1>Stall Monitor - Setup</h1>
        <div class="user-menu">
            <i class="fas fa-user-circle"></i>
            <div class="dropdown-content">
                <a href="/cancel.html" id="unsubscribe-link">Unsubscribe</a>
                <a href="#" id="signout-link">Sign Out</a>
            </div>
        </div>
    </header>

    <div class="main-content" style="max-width: 600px; text-align: left;">
        <h2>Get Started with Stall Monitor</h2>
        <p>Welcome! Follow these steps to set up your monitoring system:</p>

        <ol>
            <li>
                <strong>Download the Desktop App:</strong><br>
                This application runs on your farm's computer to process camera feeds. <br>
                <a href="#" download="StallMonitorSetup.exe">Download Stall Monitor App (Windows)</a><br>
                </li>
            <br>
            <li>
                <strong>Download Detection Models:</strong><br>
                These are the AI models needed by the desktop app.<br>
                <a href="#" download="heat_model.pt">Download Heat Detection Model</a><br>
                <a href="#" download="calving_model.pt">Download Calving Detection Model</a>
            </li>
            <br>
            <li>
                <strong>Install and Configure:</strong><br>
                Run the downloaded installer and follow the instructions in the app to connect your cameras and load the models.
            </li>
            <br>
            <li>
                <strong>Go to Your Dashboard:</strong><br>
                Once the desktop app is running, you can view your farm's activity.<br>
                <a id="dashboard-link" href="#">Go to My Dashboard</a>
            </li>
        </ol>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loggedInUser = localStorage.getItem('loggedInUser');
            if (!loggedInUser) {
                window.location.href = '/index.html';
                return;
            }

            const userMenu = document.querySelector('.user-menu');
            const dropdownContent = document.querySelector('.dropdown-content');

            if (userMenu && dropdownContent) {
                userMenu.addEventListener('click', (event) => {
                    event.stopPropagation();
                    dropdownContent.classList.toggle('dropdown-active');
                });

                window.addEventListener('click', (event) => {
                    if (!userMenu.contains(event.target)) {
                        dropdownContent.classList.remove('dropdown-active');
                    }
                });
            }

            const signoutLink = document.getElementById('signout-link');
            signoutLink.addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('loggedInUser');
                localStorage.removeItem('stallMonitorRememberedUser');
                window.location.href = '/index.html';
            });

            const params = new URLSearchParams(window.location.search);
            let farmName = params.get('farm'); // Get from URL first

            if (!farmName) {
                // If not in URL, try getting from localStorage
                const user = JSON.parse(loggedInUser);
                farmName = user.farmName;
            }

            const dashboardLink = document.getElementById('dashboard-link');

            if (farmName) {
                dashboardLink.href = `/dashboard.html?farm=${encodeURIComponent(farmName)}`; // Set the correct link
            } else {
                // If farm name isn't found, maybe link back home or show an error
                dashboardLink.textContent = "Go Home (Farm name not found)";
                dashboardLink.href = `/`;
            }
        });
    </script>
    
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 Stall Monitor. All rights reserved.</p>
            <nav class="footer-links">
                <a href="/index.html">Home</a>
                <a href="/cancel.html">Unsubscribe</a>
                <a href="/contact.html">Contact</a>
                </nav>
        </div>
    </footer>
</body>
</html>